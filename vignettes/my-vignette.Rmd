---
title: "CatastRo Package"
author: "Angel Delgado"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{CatastRo Package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Introduction to the API

This R package is aimed to query  the information from the [Sede electr√≥nica del Catastro](http://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCoordenadas.asmx) API directly through a R ide. 

This API is used to retrieve the spatial coordinates of a property, moreover it is not needed to be de owner for get the information, it is simply enough to know the casdrastral reference (RC) of the property and its address (in fact, it is only completely compulsory to know the RC, however, to ensure the query and avoid mistakes in the RC, the address can be pass to the query too).

Secondly, the API can be used to obtain a RC of a property, for this information, the API ask for the latitude and the latitude. Furthermore, it allows to choose the spacial reference (SRS) to express the coordinates between a list of them.

Finally, the API approach the issue of not know the exact point which the property has been registered. In this case, it will return all the properties located in a square 50-meters-side around the given point.

The documentation of this API can be found [here](http://www.catastro.meh.es/ayuda/lang/castellano/servicios_web.htm).

## Installation

The package has been uploaded to github therefore, it can be installed using the `devtools` library.
```
library(devtools)
install_github("DelgadoPanadero/CatastRo")
```
```{r, include=FALSE}
library(devtools)
install_github("DelgadoPanadero/CatastRo")
library(CatastRo)
```
## Functions of the package
### Query a coordinate

The function `getRC` recives the coordinates *lat* and *lon* and the spatial reference (SRS) used to express them. The return is a list with the casdastral reference of the property in that point, as well as its address (town street and number).


```{r}
reference <- getRC(lat = -3.45624183836806, lon = 38.6196566583596,SRS = 'EPSG:4230')
print(reference)
``` 

If the *SRS* is not given, the spatial reference by default is EPSG:4230.

```{r}
reference <- getRC(lat = -3.45624183836806, lon = 38.6196566583596)
print(reference)
``` 

It is also possible to get all the cadastral references in a square of 50 meters side centered in the coordinates *lat* and *lon* throught the function `getRC_distance`.

```{r}
references <- getRC_distance(lat = -3.45624183836806, lon = 38.6196566583596, SRS = 'EPSG:4230')
print(references)
``` 

### Query CPMRC 

The opposite query is possible as well. Given to the function `getCOOR` a cadastral reference (*RC*), the province (*Province*) and the  town (*Municipality*), `getCOOR` returns its coordinates *lat* and *lon* in a particular *SRS* besides the direction (town, street and number).

```{r}
direction <- getCOOR(RC = '13077A01800039', 
                      SRS = 'EPSG:4230',
                      Province = 'CIUDAD REAL', 
                      Municipality = 'SANTA CRUZ DE MUDELA')
print(direction)
```

The argument SRS could be missed, in that case, `getCOOR()` returns the coordinates with which was stored.

```{r}
direction <- getCOOR(RC = '13077A01800039', Province = 'CIUDAD REAL', Municipality = 'SANTA CRUZ DE MUDELA')
print(direction)
```

Neither the *Province* nor *Municipality* are required to be passed to the function, unless *Municipality* are given, in that case the  argument *Province* is needed. The function `getCOOR` will throw an error if this happends.

```{r error=TRUE}
direction <- getCOOR(RC = '13077A01800039',  Municipality = 'SANTA CRUZ DE MUDELA')
direction <- getCOOR(RC = '13077A01800039')
print(direction)
```

## Integrated tests
